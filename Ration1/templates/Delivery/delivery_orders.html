{% extends 'Delivery/base.html' %}
{% block content %}
<style>
    .animate-charcter
    {
       text-transform: uppercase;
      background-image: linear-gradient(
        -225deg,
        #231557 0%,
        #44107a 29%,
        #ff1361 67%,
        #fff800 100%
      );
      background-size: auto auto;
      background-clip: border-box;
      background-size: 200% auto;
      color: #fff;
      background-clip: text;
      text-fill-color: transparent;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: textclip 2s linear infinite;
      display: inline-block;
          font-size: 49px;
          font-weight: bold;
    }
    
    @keyframes textclip {
      to {
        background-position: 200% center;
      }
    }
</style>
<div class="col-md-12 text-center">
    <h3 class="animate-charcter"> Total Orders Received: {{ total_orders_received }}</h3>
</div>
<div class="container mt-5">
    <h3>Delivery Assignments</h3>
    
    <div class="table-responsive mt-4">
        <table class="table table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Delivery Code</th>
                    <th scope="col">Received Date</th>
                    <th scope="col">Total Amount</th>
                    <th scope="col">Payment Status</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for order in grouped_orders %}
                <tr>
                    <td>{{ order.delivery_code }}</td>
                    <td>{{ order.delivery_date }}</td>
                    <td>{{ order.total_amount }}</td>
                    <td>
                        <span class="badge badge-{{ order.payment_status|lower }}">{{ order.payment_status }}</span>
                    </td>
                    <td>
                        <div class="btn-group" role="group">
                            <a href="{% url 'view_details' order.customer.id %}" class="btn btn-sm btn-info" title="View Delivery Details">
                                <i class="fas fa-eye"></i> View Details
                            </a>
                            <form method="post" action="{% url 'mark_as_picked' order.customer.id %}" class="confirmation">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-success" name="action" value="picked" title="Accept Delivery">
                                    <i class="fas fa-check"></i> Accept Delivery
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(document).on('click', '.btn.btn-sm.btn-success', function(e) {
            e.preventDefault(); // Prevent the default button click behavior
            var button = $(this);
            var confirmation = confirm('Are you sure you want to accept this delivery?');
            if (confirmation) {
                button.closest('form').submit(); // Submit the form if the user confirms
            }
        });
    });
</script>

{% endblock %}
