{% extends 'customer/base.html' %}
{% load static %}
{% block content %}
{% if message %}
<script>
    alert("{{ message }}")
</script>
{% endif %}
<br>
<br>

<div class="container">

    <div class="page-header text-center">
        <h3>Payment</h3>
    </div>
    <div class="breadcrumb-section breadcrumb-bg">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 offset-lg-2 text-center">
                    <div class="breadcrumb-text">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Credit Card Payment Form - START -->

    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header text-center">
                    <h5 class="card-title">Payable Amount: {{ asz }}</h5>
                </div>
                <div class="card-body">
                    <form method="post" action="chpayment">
                        {% csrf_token %}

                        <div class="form-group">
                            <label for="cardNumber">Card Number</label>
                            <input type="tel" class="form-control" id="cardNumber" placeholder="Valid Card Number" required pattern="[0-9]{16}" />
                            <span id="cardNumberError" class="error-message"></span>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="expirationDate">Expiration Date</label>
                                <input type="tel" class="form-control" id="expirationDate" placeholder="MM / YY" required />
                            </div>
                            <div class="form-group col-md-6">
                                <label for="cvCode">CV Code</label>
                                <input type="tel" class="form-control" id="cvCode" placeholder="CVC" pattern="[0-9]{3}" required />
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="cardOwner">Card Owner</label>
                            <input type="text" class="form-control" id="cardOwner" placeholder="Card Owner Names" required />
                        </div>

                    <div class="text-center">
                        <button class="btn btn-warning btn-lg" type="submit">Process Payment</button>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Credit Card Payment Form - END -->

</div>


<script>
    document.getElementById("cardNumber").addEventListener("input", function() {
        var cardNumber = this.value;
        var cardNumberError = document.getElementById("cardNumberError");

        // Reset previous error message
        cardNumberError.innerHTML = "";

        // Validate card number
        if (!cardNumber.match(/^[0-9]{16}$/)) {
            cardNumberError.innerHTML = "Please enter a valid 16-digit card number.";
            cardNumberError.style.color = "red";
        } else {
            cardNumberError.innerHTML = "Card number is valid.";
            cardNumberError.style.color = "green"; // Change color to green if valid
        }
    });
</script>

<script>
    document.getElementById('expirationDate').addEventListener('input', function () {
        var input = this.value.replace(/\s/g, '');
        if (/^\d{2}\/\d{2}$/.test(input)) {
            var [month, year] = input.split('/');
            var currentDate = new Date();
            var currentMonth = currentDate.getMonth() + 1;
            var currentYear = currentDate.getFullYear() % 100;

            if (parseInt(month) > 0 && parseInt(month) <= 12 && parseInt(year) >= currentYear) {
                this.setCustomValidity('');
                this.style.borderColor = '';
            } else {
                this.setCustomValidity('Invalid expiration date');
                this.style.borderColor = 'red';
            }
        } else {
            this.setCustomValidity('Invalid format (MM/YY)');
            this.style.borderColor = 'red';
        }
    });
</script>

<script>
    document.getElementById('cvCode').addEventListener('input', function () {
        var input = this.value.replace(/\s/g, '');
        if (/^\d{3}$/.test(input)) {
            this.setCustomValidity('');
            this.style.borderColor = '';
        } else {
            this.setCustomValidity('Invalid CV code');
            this.style.borderColor = 'red';
        }
    });
</script>
<script>
    document.getElementById('cardOwner').addEventListener('input', function () {
        var input = this.value.replace(/\s/g, '');
        if (/^[a-zA-Z\s]*$/.test(input)) {
            this.setCustomValidity('');
            this.style.borderColor = '';
        } else {
            this.setCustomValidity('Invalid characters. Only letters and spaces are allowed');
            this.style.borderColor = 'red';
        }
    });
</script>

{% endblock %}
